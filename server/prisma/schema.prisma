generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String         @id @default(uuid())
  username     String         @unique
  email        String         @unique
  password     String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  comments     Comment[]
  ratings      Rating[]
  watchHistory WatchHistory[]
}

model Comment {
  id          String   @id @default(uuid())
  content     String
  movieSlug   String
  episodeSlug String
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Rating {
  id        String   @id @default(uuid())
  score     Int
  movieSlug String
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, movieSlug])
}

model WatchHistory {
  id          String   @id @default(uuid())
  movieSlug   String
  movieName   String
  posterUrl   String?
  episodeSlug String
  episodeName String
  progress    Int      @default(0) // Seconds
  duration    Int      @default(0) // Total seconds
  lastWatched DateTime @default(now())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([userId, movieSlug, episodeSlug])
}

model Room {
  id          String   @id @default(uuid())
  roomId      String   @unique
  host        String? // Socket ID
  hostUserId  String? // User ID (for persistence) 
  videoUrl    String?
  movieSlug   String?
  currentTime Int      @default(0)
  isPlaying   Boolean  @default(false)
  lastEmptyAt DateTime?
  members     Json     @default("[]") // Store members as JSON array
  createdAt   DateTime @default(now())
}
